# Настройка оплаты в Pizza Bot

## Как настроить оплату

### 1. Получение токена платежной системы

Для работы оплаты нужно получить токен от платежного провайдера. Telegram поддерживает:

#### ЮKassa (рекомендуется для России)
1. Зарегистрируйтесь на https://yookassa.ru/
2. Создайте магазин
3. Получите токен в разделе "Интеграция" → "Платежи в Telegram"
4. Скопируйте токен провайдера

#### Тестовый режим (для разработки)
Используйте тестовый токен от Telegram:
- **Тестовый токен**: `381764678:TEST:...` (получите в @BotFather)

### 2. Настройка бота

1. Откройте файл `.env` или настройте переменную окружения:
```bash
PAYMENT_TOKEN=ваш_токен_от_провайдера
```

2. Или отредактируйте файл `src/config/settings.py`:
```python
PAYMENT_TOKEN = 'ваш_токен_от_провайдера'
```

### 3. Как работает оплата

1. **Без токена** (по умолчанию):
   - Создается заказ со статусом "pending"
   - Оплата не требуется
   - Администратор видит заказ в админ-панели

2. **С токеном**:
   - Пользователь добавляет товары в корзину
   - При нажатии "Оформить заказ" появляется инвойс для оплаты
   - После успешной оплаты создается заказ со статусом "paid"
   - Администратор получает уведомление о новом заказе

### 4. Тестирование оплаты

Используйте тестовые карты:
- **Успешная оплата**: `4111 1111 1111 1111`
- **Отклонена**: `4000 0000 0000 0002`
- Любой CVV (например, 123)
- Любая будущая дата

### 5. Дополнительные настройки

В файле `src/handlers/user/catalog.py` можно настроить:
- `need_name` - запрашивать имя
- `need_phone_number` - запрашивать телефон
- `need_email` - запрашивать email
- `need_shipping_address` - запрашивать адрес доставки
- `is_flexible` - гибкая цена (для доставки)

## Важно

⚠️ **Не публикуйте рабочие токены в открытом доступе!**

✅ Используйте переменные окружения для production

✅ Проверьте, что бот может принимать платежи (настройки @BotFather → `/mybots` → выбрать бота → `Payments`)